<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>成績表（試作品）</title>
  <style>
    :root{
      --bg:#f6f7f9; --card:#fff; --text:#111; --muted:#6b7280; --line:#e5e7eb;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:14px 14px 40px}
    .topbar{display:flex;gap:10px;align-items:center;margin:6px 0 10px}
    .title{font-size:16px;font-weight:700}
    .tabs{display:flex;gap:6px;flex-wrap:wrap;margin:10px 0 12px}
    .tabbtn{
      border:1px solid var(--line); background:var(--card); padding:8px 12px; border-radius:999px;
      font-size:13px; color:var(--muted); cursor:pointer;
    }
    .tabbtn.active{background:#111;color:#fff;border-color:#111}
    .periods{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 12px}
    .chip{
      border:1px solid var(--line); background:var(--card); padding:8px 12px; border-radius:999px;
      font-size:13px; cursor:pointer;
    }
    .chip.active{background:#111;color:#fff;border-color:#111}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:14px}
    .sectionTitle{font-size:14px;font-weight:700;margin:2px 0 10px}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    .metricName{font-size:12px;color:var(--muted);margin-bottom:6px}
    .metricValue{font-size:28px;font-weight:800;letter-spacing:0.3px}
    .metricDelta{font-size:12px;color:var(--muted);margin-top:6px}
    .chartBox{margin-top:10px}
    .subtabs{display:flex;gap:6px;flex-wrap:wrap;margin:10px 0 8px}
    .subbtn{
      border:1px solid var(--line); background:var(--card); padding:8px 12px; border-radius:999px;
      font-size:13px; color:var(--muted); cursor:pointer;
    }
    .subbtn.active{background:#eef2ff;color:#111;border-color:#c7d2fe}
    .note{font-size:12px;color:var(--muted);margin-top:10px}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="title">成績表（試作品）</div>
    </div>

    <div class="tabs" id="topTabs">
      <button class="tabbtn active" data-tab="tab1">タブ1</button>
      <button class="tabbtn" data-tab="tab2">タブ2</button>
      <button class="tabbtn" data-tab="tab3">タブ3</button>
      <button class="tabbtn" data-tab="tab4">タブ4</button>
    </div>

    <div class="periods" id="periodChips">
      <button class="chip active" data-period="7">7日間</button>
      <button class="chip" data-period="28">28日間</button>
      <button class="chip" data-period="60">60日間</button>
      <button class="chip" data-period="365">365日間</button>
    </div>

    <div class="card">
      <div class="sectionTitle">主な指標（ダミー）</div>
      <div class="grid">
        <div class="card" style="padding:12px">
          <div class="metricName" id="m1Name">指標A</div>
          <div class="metricValue" id="m1Value">0</div>
          <div class="metricDelta" id="m1Delta">前年差：0（0%）</div>
        </div>
        <div class="card" style="padding:12px">
          <div class="metricName" id="m2Name">指標B</div>
          <div class="metricValue" id="m2Value">0</div>
          <div class="metricDelta" id="m2Delta">前年差：0（0%）</div>
        </div>
      </div>

      <div class="chartBox">
        <canvas id="mainChart" height="120"></canvas>
        <div class="note">※グラフが出ない場合は、ネット接続がある状態で開いてください（グラフ部品を読み込みます）。</div>
      </div>
    </div>

    <div style="height:12px"></div>

    <div class="card">
      <div class="sectionTitle">内訳（ダミー）</div>
      <div class="subtabs" id="subTabs">
        <button class="subbtn active" data-sub="s1">内訳1</button>
        <button class="subbtn" data-sub="s2">内訳2</button>
        <button class="subbtn" data-sub="s3">内訳3</button>
      </div>

      <div id="s1" class="subpanel">ここに内訳1を表示（後で差し替え）</div>
      <div id="s2" class="subpanel hidden">ここに内訳2を表示（後で差し替え）</div>
      <div id="s3" class="subpanel hidden">ここに内訳3を表示（後で差し替え）</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // ダミーデータ（あとで実データに置き換える）
    const dummy = {
      "7":  { labels:["12/9","12/10","12/11","12/12","12/13","12/14","12/15"], values:[520,480,460,390,510,560,630],
              m1:{name:"指標A", value:3635, diff:-713, pct:-16.4}, m2:{name:"指標B", value:2128, diff:-436, pct:-17.0} },
      "28": { labels:Array.from({length:28},(_,i)=>`D${i+1}`), values:Array.from({length:28},()=>Math.floor(350+Math.random()*350)),
              m1:{name:"指標A", value:12345, diff:120, pct:1.0}, m2:{name:"指標B", value:6789, diff:-55, pct:-0.8} },
      "60": { labels:Array.from({length:12},(_,i)=>`W${i+1}`), values:Array.from({length:12},()=>Math.floor(400+Math.random()*300)),
              m1:{name:"指標A", value:54321, diff:2100, pct:4.0}, m2:{name:"指標B", value:9876, diff:300, pct:3.1} },
      "365":{ labels:Array.from({length:12},(_,i)=>`${i+1}月`), values:Array.from({length:12},()=>Math.floor(300+Math.random()*400)),
              m1:{name:"指標A", value:222222, diff:12000, pct:5.7}, m2:{name:"指標B", value:111111, diff:-4000, pct:-3.5} },
    };

    const el = (id)=>document.getElementById(id);

    function fmt(n){ return n.toLocaleString("ja-JP"); }
    function deltaText(d,p){ return `前年差：${d>=0?"+":""}${fmt(d)}（${p>=0?"+":""}${p}%）`; }

    let currentPeriod = "7";
    let chart;

    function setMetrics(p){
      const d = dummy[p];
      el("m1Name").textContent  = d.m1.name;
      el("m1Value").textContent = fmt(d.m1.value);
      el("m1Delta").textContent = deltaText(d.m1.diff, d.m1.pct);

      el("m2Name").textContent  = d.m2.name;
      el("m2Value").textContent = fmt(d.m2.value);
      el("m2Delta").textContent = deltaText(d.m2.diff, d.m2.pct);
    }

    function setChart(p){
      const d = dummy[p];
      const ctx = document.getElementById("mainChart").getContext("2d");

      if(!chart){
        chart = new Chart(ctx, {
          type:"line",
          data:{ labels:d.labels, datasets:[{ label:"推移", data:d.values, tension:0.35, pointRadius:3 }] },
          options:{
            responsive:true,
            plugins:{ legend:{ display:false } },
            scales:{ x:{ grid:{ display:false } }, y:{ beginAtZero:false } }
          }
        });
      }else{
        chart.data.labels = d.labels;
        chart.data.datasets[0].data = d.values;
        chart.update();
      }
    }

    function setPeriod(p){
      currentPeriod = p;
      document.querySelectorAll("#periodChips .chip").forEach(b=>b.classList.toggle("active", b.dataset.period===p));
      setMetrics(p);
      setChart(p);
    }

    // 上タブ（見た目だけ。中身は今は変えない）
    document.getElementById("topTabs").addEventListener("click",(e)=>{
      const b = e.target.closest("button"); if(!b) return;
      document.querySelectorAll("#topTabs .tabbtn").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
    });

    // 期間ボタン
    document.getElementById("periodChips").addEventListener("click",(e)=>{
      const b = e.target.closest("button"); if(!b) return;
      setPeriod(b.dataset.period);
    });

    // 内訳タブ
    document.getElementById("subTabs").addEventListener("click",(e)=>{
      const b = e.target.closest("button"); if(!b) return;
      document.querySelectorAll("#subTabs .subbtn").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      document.querySelectorAll(".subpanel").forEach(p=>p.classList.add("hidden"));
      document.getElementById(b.dataset.sub).classList.remove("hidden");
    });

    // 初期表示
    setPeriod("7");
  </script>
</body>
</html>
